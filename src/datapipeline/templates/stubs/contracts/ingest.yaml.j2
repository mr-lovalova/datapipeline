kind: ingest
source: {{ source }}
id: {{ stream_id }}  # format: domain.dataset.(variant)

mapper:
  entrypoint: {{ mapper_entrypoint }}
  args: {}

cadence: ${group_by}                # optional per-contract cadence
# partition_by: <field or [fields]>
# sort_batch_size: 100000              # in-memory sort chunk size

record:                              # record-level transforms
  - filter: { field: time, operator: ge, comparand: "${start_time}" }
  - filter: { field: time, operator: le, comparand: "${end_time}" }
  - floor_time: { cadence: "${cadence}" }
#   - lag: { lag: 10m }

stream:                              # per-feature transforms (input sorted by id,time)
  - ensure_cadence: { field: value, to: value, cadence: "${cadence}" }
  - granularity: { field: value, to: value, mode: first }
#   - fill: { field: value, to: value, statistic: median, window: 6, min_samples: 1 }

debug:                               # optional validation-only checks
  - lint: { mode: warn, tick: "${cadence}" }
