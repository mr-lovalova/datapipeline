kind: ingest
source: sandbox.ohlcv
id: equity.ohlcv # format: domain.dataset.(variant)

mapper:
  entrypoint: map_sandbox_ohlcv_dto_to_equity
  args: {}

cadence: ${group_by} # optional per-contract cadence
partition_by: ticker
# sort_batch_size: 100000              # in-memory sort chunk size

record: # record-level transforms
  - filter: { operator: ge, field: time, comparand: "${start_time}" }
  - filter: { operator: le, field: time, comparand: "${end_time}" }
  - floor_time: { cadence: "${cadence}" }
#   - lag: { lag: 10m }

stream: # per-feature transforms (input sorted by id,time)
  - ensure_cadence: { cadence: "${cadence}" }
  - granularity: { mode: first }
  - rolling: { window: 5, statistic: mean, min_samples: 5, out_id: adv5 }
#   - fill: { statistic: median, window: 6, min_samples: 1 }

debug: # optional validation-only checks
  - lint: { mode: warn, tick: "${cadence}" }
